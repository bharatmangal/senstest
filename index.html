<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Motion Detection</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; text-align: center; }
    h1 { font-size: 1.5rem; }
    #status { font-size: 1.3rem; margin-top: 20px; padding: 10px; border: 2px solid #333; display: inline-block; }
    button { margin-top: 20px; padding: 10px 20px; font-size: 1rem; }
    .moving { color: green; }
    .stopped { color: red; }
    .controls { margin-top: 20px; }
    .controls label { display: block; margin: 10px 0 5px; }
  </style>
</head>
<body>
  <h1>Phone Motion Detection</h1>
  <p>Press the button to allow motion/orientation permissions and start detection.</p>
  <button id="startBtn">Start Detection</button>
  <div id="status">Waiting for input...</div>

  <div class="controls">
    <label for="threshold">Motion Sensitivity (Threshold: <span id="thresholdValue">1.0</span>)</label>
    <input type="range" id="threshold" min="0.1" max="5.0" step="0.1" value="1.0">

    <label for="bufferSize">Buffer Size (Readings: <span id="bufferValue">5</span>)</label>
    <input type="range" id="bufferSize" min="1" max="20" step="1" value="5">
  </div>

  <script>
    const statusEl = document.getElementById("status");
    const thresholdSlider = document.getElementById("threshold");
    const bufferSlider = document.getElementById("bufferSize");
    const thresholdValueEl = document.getElementById("thresholdValue");
    const bufferValueEl = document.getElementById("bufferValue");

    let threshold = parseFloat(thresholdSlider.value);
    let bufferSize = parseInt(bufferSlider.value);

    thresholdSlider.addEventListener("input", () => {
      threshold = parseFloat(thresholdSlider.value);
      thresholdValueEl.textContent = threshold.toFixed(1);
    });

    bufferSlider.addEventListener("input", () => {
      bufferSize = parseInt(bufferSlider.value);
      bufferValueEl.textContent = bufferSize;
    });

    function updateStatus(isMoving) {
      if (isMoving) {
        statusEl.textContent = "ðŸš¶ Phone is Moving";
        statusEl.className = "moving";
      } else {
        statusEl.textContent = "ðŸ›‘ Phone is Stopped";
        statusEl.className = "stopped";
      }
    }

    function startDetection() {
      if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
        DeviceMotionEvent.requestPermission().then(response => {
          if (response === 'granted') {
            window.addEventListener('devicemotion', motionHandler);
          } else {
            alert('Permission denied for motion sensors');
          }
        });
      } else {
        window.addEventListener('devicemotion', motionHandler);
      }
    }

    let lastAcceleration = { x: 0, y: 0, z: 0 };
    let deltas = [];
    let lastMoveTime = 0;
    let isMoving = false;

    function motionHandler(event) {
      if (!event.accelerationIncludingGravity) return;

      const acc = event.accelerationIncludingGravity;
      const dx = acc.x - lastAcceleration.x;
      const dy = acc.y - lastAcceleration.y;
      const dz = acc.z - lastAcceleration.z;

      const delta = Math.sqrt(dx*dx + dy*dy + dz*dz);

      deltas.push(delta);
      if (deltas.length > bufferSize) deltas.shift();

      const avgDelta = deltas.reduce((a, b) => a + b, 0) / deltas.length;

      if (avgDelta > threshold) {
        lastMoveTime = Date.now();
        if (!isMoving) {
          isMoving = true;
          updateStatus(true);
        }
      } else {
        if (isMoving && Date.now() - lastMoveTime > 500) {
          isMoving = false;
          updateStatus(false);
        }
      }

      lastAcceleration = { x: acc.x, y: acc.y, z: acc.z };
    }

    document.getElementById("startBtn").addEventListener("click", startDetection);
  </script>
</body>
</html>

