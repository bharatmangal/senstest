<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Motion Detection</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; text-align: center; }
    h1 { font-size: 1.5rem; }
    #status { font-size: 1.3rem; margin-top: 20px; padding: 10px; border: 2px solid #333; display: inline-block; }
    button { margin-top: 20px; padding: 10px 20px; font-size: 1rem; }
    .moving { color: green; }
    .stopped { color: red; }
  </style>
</head>
<body>
  <h1>Phone Motion Detection</h1>
  <p>Press the button to allow motion/orientation permissions and start detection.</p>
  <button id="startBtn">Start Detection</button>
  <div id="status">Waiting for input...</div>

  <script>
    const statusEl = document.getElementById("status");

    function updateStatus(isMoving) {
      if (isMoving) {
        statusEl.textContent = "ðŸš¶ Phone is Moving";
        statusEl.className = "moving";
      } else {
        statusEl.textContent = "ðŸ›‘ Phone is Stopped";
        statusEl.className = "stopped";
      }
    }

    function startDetection() {
      // iOS Safari requires explicit permission
      if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
        DeviceMotionEvent.requestPermission().then(response => {
          if (response === 'granted') {
            window.addEventListener('devicemotion', motionHandler);
          } else {
            alert('Permission denied for motion sensors');
          }
        });
      } else {
        // Android Chrome or other browsers
        window.addEventListener('devicemotion', motionHandler);
      }
    }

    let lastAcceleration = { x: 0, y: 0, z: 0 };
    let moving = false;
    let lastMoveTime = Date.now();

    function motionHandler(event) {
      if (!event.accelerationIncludingGravity) return;

      const acc = event.accelerationIncludingGravity;
      const dx = acc.x - lastAcceleration.x;
      const dy = acc.y - lastAcceleration.y;
      const dz = acc.z - lastAcceleration.z;

      const delta = Math.sqrt(dx*dx + dy*dy + dz*dz);

      // Detect movement if threshold exceeded
      if (delta > 1.0) {
        lastMoveTime = Date.now();
        if (!moving) {
          moving = true;
          updateStatus(true);
        }
      }

      // If no movement for 2000ms, consider stopped
      if (moving && Date.now() - lastMoveTime > 300) {
        moving = false;
        updateStatus(false);
      }

      lastAcceleration = { x: acc.x, y: acc.y, z: acc.z };
    }

    document.getElementById("startBtn").addEventListener("click", startDetection);
  </script>
</body>
</html>


